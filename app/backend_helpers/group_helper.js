/*! RaylionWebProject 27-12-2014 */
"use strict";function addGroup(a,b){return a.groupName?a.groupLeader?void docExists(groupsDb,a.groupName,function(c,d){return c?b(c):d?b("Error: group already exists"):void validateGroupLeader(a.groupLeader,a.groupName,function(c){return c?b(c):void groupsDb.save(a.groupName,{groupName:a.groupName,groupLeader:a.groupLeader,subGroups:[]},function(c){return c?b(c):void updateUser(a.groupLeader,[{action:"add group leader",name:"车间长",location:a.groupName}],function(a){return a?b(a):void b(null)})})})}):b("group leader not provided"):b("group name not provided")}function validateGroupLeader(a,b,c){usersDb.get(a,function(a,d){return c(a&&"not_found"===a.error?"Error: user set for group leader does not exists":a?a:"管理员"===d.permission.level?"Error: unable to set admin as group leader":d.permission.group&&d.permission.group!==b?"Error: user set for group leader belongs to another group":d.permission.groupLeader?"Error: user set for group leader is already a group leader":null)})}function removeGroup(){}function updateGroup(){}function getAllGroups(a){groupsDb.view("groups/all",function(b,c){return b?a(b,null):void a(null,c)})}function addSubGroup(){}function removeSubGroup(){}function updateSubGroup(){}function getAllSubGroups(){}var db_helper=require("./db_helper.js"),groupsDb=db_helper.dbConn().database("groups"),docExists=db_helper.docExists,getDoc=db_helper.getDoc,removeDoc=db_helper.removeDoc,account_helper=require("./account_helper.js"),usersDb=account_helper.usersDb,updateUser=account_helper.updateUser;exports.addGroup=addGroup,exports.removeGroup=removeGroup,exports.updateGroup=updateGroup,exports.getAllGroups=getAllGroups,exports.addSubGroup=addSubGroup,exports.removeSubGroup=removeSubGroup,exports.updateSubGroup=updateSubGroup,exports.getAllSubGroups=getAllSubGroups,exports.groupsDb=groupsDb;